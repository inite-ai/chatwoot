# Docker Buildx Optimizations in GitHub Actions

## üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ buildx –≤ deploy-main.yml

### 1. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Buildx:**
```yaml
- name: Set up Docker Buildx
  uses: docker/setup-buildx-action@v3
  with:
    driver: docker-container        # –õ—É—á—à–µ —á–µ–º default driver
    buildkitd-flags: |             # –í–∫–ª—é—á–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
      --allow-insecure-entitlement security.insecure
      --allow-insecure-entitlement network.host
    config-inline: |               # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞
      [worker.oci]
        max-parallelism = 4
      [worker.containerd]
        max-parallelism = 4
```

### 2. **–ú–Ω–æ–≥–æ—Å–ª–æ–π–Ω–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```yaml
cache-from: |
  type=registry,ref=username/chatwoot:cache    # –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π cache image
  type=registry,ref=username/chatwoot:latest   # –ü–æ—Å–ª–µ–¥–Ω–∏–π —É—Å–ø–µ—à–Ω—ã–π build
  type=gha                                     # GitHub Actions cache
```

### 3. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ–≥–∏ –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è:**
```yaml
tags: |
  username/chatwoot:latest       # –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–≥
  username/chatwoot:${github.sha} # –¢–µ–≥ —Å commit SHA –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
```

### 4. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
```yaml
build-args: |
  BUILDKIT_INLINE_CACHE=1    # –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∫–µ—à –≤ –æ–±—Ä–∞–∑
provenance: false            # –û—Ç–∫–ª—é—á–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (—É—Å–∫–æ—Ä—è–µ—Ç)
sbom: false                  # –û—Ç–∫–ª—é—á–∞–µ–º SBOM –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
```

### 5. **–£–ª—É—á—à–µ–Ω–Ω—ã–π fallback:**
- –í–∫–ª—é—á–∞–µ—Ç `DOCKER_BUILDKIT=1` –¥–ª—è —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ–≥–æ Docker
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∫–µ—à–∞
- –°–æ–∑–¥–∞–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–µ–≥–∏

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:

**–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- Registry cache + GHA cache + latest image = —Ç—Ä–æ–π–Ω–∞—è –∑–∞—â–∏—Ç–∞
- –ö–µ—à —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –∫–æ–º–º–∏—Ç–∞–º–∏ –∏ –≤–µ—Ç–∫–∞–º–∏
- Inline cache –≤ –æ–±—Ä–∞–∑–∞—Ö –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–ª–æ—è

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- `docker-container` driver –±—ã—Å—Ç—Ä–µ–µ default
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (max-parallelism = 4)
- –û—Ç–∫–ª—é—á–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤enance/sbom —ç–∫–æ–Ω–æ–º—è—Ç –≤—Ä–µ–º—è

**–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:**
- Fallback —Å —Ç–µ–º–∏ –∂–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏
- –ù–µ—Å–∫–æ–ª—å–∫–æ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∫–µ—à–∞
- –¢–µ–≥–∏ —Å SHA –¥–ª—è –ø–æ–ª–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏ –±–∏–ª–¥–æ–≤

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç:
- –ü–µ—Ä–≤—ã–π –±–∏–ª–¥: 10-15 –º–∏–Ω—É—Ç
- –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –±–∏–ª–¥—ã: 1-3 –º–∏–Ω—É—Ç—ã (—Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–∏–≤—à–∏–µ—Å—è —Å–ª–æ–∏)
- –ö–µ—à —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É –∫–æ–º–º–∏—Ç–∞–º–∏
- –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ Docker Hub (–º–µ–Ω—å—à–µ –ø—É–ª–æ–≤)
