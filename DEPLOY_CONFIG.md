# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–µ–ø–ª–æ—è Chatwoot

## –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ–º–µ–Ω–∞ –∏ –ø—Ä–æ–µ–∫—Ç–∞ —Ç–µ–ø–µ—Ä—å —Å–æ–±—Ä–∞–Ω—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ –≤ `.github/workflows/deploy-main.yml`:

```yaml
env:
  PROJECT_NAME: chatwoot
  DOMAIN: chat.inite.ai  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω
```

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### 1. –î–æ–º–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤–æ –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

- **Traefik** - –ø–æ–ª—É—á–∞–µ—Ç –¥–æ–º–µ–Ω —á–µ—Ä–µ–∑ –ª–µ–π–±–ª—ã Docker
- **Rails** - –ø–æ–ª—É—á–∞–µ—Ç –¥–æ–º–µ–Ω —á–µ—Ä–µ–∑ `FRONTEND_URL`
- **Sidekiq** - —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á
- **Database** - PostgreSQL —Å pgvector –¥–ª—è AI —Ñ—É–Ω–∫—Ü–∏–π
- **Redis** - –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—á–µ—Ä–µ–¥–µ–π –∑–∞–¥–∞—á

### 2. HTTPS –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è Traefik:

```
–ò–Ω—Ç–µ—Ä–Ω–µ—Ç ‚Üí Cloudflare (SSL) ‚Üí Traefik (HTTP) ‚Üí Rails (HTTP) ‚Üí App
```

**–í–∞–∂–Ω–æ**: Traefik –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ Let's Encrypt.

### 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–µ–ø–ª–æ—è:

```
rails:3000 ‚Üê HTTP ‚Üê Traefik:80/443
sidekiq      ‚Üê Background Jobs
postgres:5432 ‚Üê Database
redis:6379   ‚Üê Cache & Queues
```

## –î–µ–ø–ª–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Production –¥–µ–ø–ª–æ–π (`deploy.yml`)
- –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ –≤—Å–µ–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
- Traefik –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å SSL
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ health checks
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Docker build
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Mailgun –¥–ª—è email

## –ê–∫—Ç–∏–≤–Ω—ã–µ GitHub Actions workflows

–ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ —É –Ω–∞—Å –æ—Å—Ç–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ workflows:

- **deploy.yml** - production –¥–µ–ø–ª–æ–π
- **run_foss_spec.yml** - Ruby/Rails —Ç–µ—Å—Ç—ã
- **frontend-fe.yml** - Frontend —Ç–µ—Å—Ç—ã (JS/Vue)
- **lint_pr.yml** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ PR
- **size-limit.yml** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ JS –±–∞–Ω–¥–ª–∞
- **auto-assign-pr.yml** - –∞–≤—Ç–æ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ PR

–£–¥–∞–ª–µ–Ω—ã workflows —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º Chatwoot —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º:
- ~~deploy_check.yml~~ - –ø—Ä–æ–≤–µ—Ä–∫–∞ Heroku deployments
- ~~publish_foss_docker.yml~~ - –ø—É–±–ª–∏–∫–∞—Ü–∏—è –≤ chatwoot/chatwoot
- ~~publish_ee_docker.yml~~ - –ø—É–±–ª–∏–∫–∞—Ü–∏—è Enterprise –≤–µ—Ä—Å–∏–∏
- ~~nightly_installer.yml~~ - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Linux installer
- ~~publish_codespace_image.yml~~ - GitHub Codespaces
- ~~test_docker_build.yml~~ - —Ç–µ—Å—Ç–æ–≤—ã–π Docker build
- ~~logging_percentage_check.yml~~ - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- ~~stale.yml~~ - –ø–æ–º–µ—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö PR
- ~~lock.yml~~ - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ issues

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**üìã –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ [GITHUB_SECRETS.md](./GITHUB_SECRETS.md)**

### –ö—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤:

```bash
# Docker Hub
DOCKERHUB_USERNAME, DOCKERHUB_TOKEN

# Database  
DB_PASSWORD, REDIS_PASSWORD

# Rails
SECRET_KEY_BASE

# Email (SMTP) - —Ç–æ–ª—å–∫–æ –ø–∞—Ä–æ–ª—å
MAIL_PASSWORD  # –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã

# Facebook (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
FB_VERIFY_TOKEN, FB_APP_SECRET, FB_APP_ID
```

> ‚ö†Ô∏è **–í–∞–∂–Ω–æ**: –î–æ–±–∞–≤—å—Ç–µ –≤—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ GitHub Repository Settings ‚Üí Secrets and variables ‚Üí Actions

## –î–ª—è —Å–º–µ–Ω—ã –¥–æ–º–µ–Ω–∞

1. –ò–∑–º–µ–Ω–∏—Ç–µ `DOMAIN` –≤ `.github/workflows/deploy.yml`:
   ```yaml
   env:
     DOMAIN: your-new-domain.com
   ```

2. –°–¥–µ–ª–∞–π—Ç–µ commit –∏ push - –¥–µ–ø–ª–æ–π –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
bundle install && pnpm install

# –ó–∞–ø—É—Å–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
pnpm dev
# –∏–ª–∏
overmind start -f ./Procfile.dev
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```
/opt/projects/chatwoot/
‚îú‚îÄ‚îÄ current/              # –¢–µ–∫—É—â–∏–π –¥–µ–ø–ª–æ–π
‚îú‚îÄ‚îÄ backup-20240101_120000/  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã
‚îî‚îÄ‚îÄ backup-20240102_150000/
```

## Troubleshooting

### 404 Not Found
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–æ–º–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ DNS
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Traefik: `docker logs traefik-global`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤: `docker-compose -f docker-compose.prod.yml ps`

### 500 Internal Server Error
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Rails: `docker-compose -f docker-compose.prod.yml logs rails`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ—à–ª–∏: `docker-compose -f docker-compose.prod.yml exec rails bundle exec rails db:migrate:status`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ GitHub Secrets

### Database Connection Issues
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å PostgreSQL: `docker-compose -f docker-compose.prod.yml logs postgres`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `DB_PASSWORD` –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤ —Å–µ–∫—Ä–µ—Ç–∞—Ö
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ health check –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### ERR_TOO_MANY_REDIRECTS
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ Traefik –Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏—Ö –ø—Ä–∞–≤–∏–ª
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Cloudflare –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

### SSL –ø—Ä–æ–±–ª–µ–º—ã
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–º–µ–Ω —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Å Traefik
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Let's Encrypt –ª–æ–≥–∏ –≤ Traefik
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç—ã 80 –∏ 443 –æ—Ç–∫—Ä—ã—Ç—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–∞–º—è—Ç—å—é –ø—Ä–∏ –±–∏–ª–¥–µ
- –£–≤–µ–ª–∏—á—å—Ç–µ `NODE_OPTIONS=--max-old-space-size=4096` –≤ workflow
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ fallback —Ä–µ–∂–∏–º –±–∏–ª–¥–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–±–æ–µ BuildKit)

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

```bash
# –õ–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose -f docker-compose.prod.yml logs -f

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker-compose -f docker-compose.prod.yml logs -f rails
docker-compose -f docker-compose.prod.yml logs -f sidekiq

# –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose -f docker-compose.prod.yml ps

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ GitHub Secrets
- SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∏–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–µ—Ç–∏ Docker
- Redis –∑–∞—â–∏—â–µ–Ω –ø–∞—Ä–æ–ª–µ–º
- –õ–æ–≥–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

## Backup –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã
- –°—Ç–∞—Ä—ã–µ –¥–µ–ø–ª–æ–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ë—ç–∫–∞–ø—ã —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –†—É—á–Ω–æ–π –±—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
docker-compose -f docker-compose.prod.yml exec postgres pg_dump -U postgres chatwoot > backup.sql
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
docker-compose -f docker-compose.prod.yml exec -T postgres psql -U postgres chatwoot < backup.sql
```
